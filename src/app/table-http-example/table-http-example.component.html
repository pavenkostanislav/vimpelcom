<code>{{ filterForm.value | json }}</code>
<div class="container-fluid">
  <div class="row row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-3 bd-sidebar" [formGroup]="filterForm">
      <ul class="list-group list-group-flush">
        <li class="list-group-item">Фильтры<mat-icon>tune</mat-icon></li>
        <li class="list-group-item" *ngFor="let f of filters; index as k">
          <!-- <code>{{ filterForm.value[filters[k].key] | json }}</code> -->
          <!-- <code>expanded = {{ filters[k].isOpen }}</code> -->
          <span class="bottom-dashed">{{ filters[k].name }}</span>
          <div
            *ngIf="filters[k].type === 'common' || filters[k].type === 'color'"
            [formArrayName]="filters[k].key"
          >
            <div
              class="form-check"
              *ngFor="
                let item of getFormArray(filters[k].key).controls;
                index as i
              "
            >
              <input
                type="checkbox"
                class="form-check-input btn-outline-warning"
                [formControlName]="i"
                (input)="setFilter()"
              />
              <label class="form-check-label">
                <span [ngStyle]="{ color: getOption(k, i, 'color') }">
                  <mat-icon *ngIf="filters[k].type === 'color'">
                    palette
                  </mat-icon>
                </span>
                <span class="text-dark">
                  {{ getOption(k, i, "name") }}
                </span>
                <span class="text-secondary">
                  {{ getOption(k, i, "productsCount") }}
                </span>
              </label>
            </div>
          </div>

          <div *ngIf="filters[k].type === 'range'">
            <bm-range-slider
              ngDefaultControl
              [formControlName]="filters[k].key"
              [value]="filters[k].min || 0"
              [highValue]="filters[k].max || 100000"
              [options]="{
                floor: filters[k].min || 0,
                ceil: filters[k].max || 100000,
                animate: true,
                hideLimitLabels: true,
                hidePointerLabels: true
              }"
            >
            </bm-range-slider>
            <!-- (valueChange)="setFilter()"
              (highValueChange)="setFilter()" -->
            <div
              class="input-group text-warning d-flex justify-content-between"
            >
              <input
                type="number"
                class="form-control text-warning"
                [value]="getFormControl(filters[k].key).value[0]"
                (focusout)="
                  getFormControl(filters[k].key).setValue([
                    $event.target['value'],
                    getFormControl(filters[k].key).value[1]
                  ]);
                  setFilter()
                "
                (keydown.enter)="
                  getFormControl(filters[k].key).setValue([
                    $event.target['value'],
                    getFormControl(filters[k].key).value[1]
                  ]);
                  setFilter()
                "
              />
              <span class="input-group-text text-warning">
                <mat-icon>horizontal_rule</mat-icon>
              </span>
              <input
                type="number"
                class="form-control text-warning"
                [value]="getFormControl(filters[k].key).value[1]"
                (focusout)="
                  getFormControl(filters[k].key).setValue([
                    getFormControl(filters[k].key).value[0],
                    $event.target['value']
                  ]);
                  setFilter()
                "
                (keydown.enter)="
                  getFormControl(filters[k].key).setValue([
                    getFormControl(filters[k].key).value[0],
                    $event.target['value']
                  ]);
                  setFilter()
                "
              />
              <span class="input-group-text text-warning">₽</span>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <main class="col-12 col-md-9 col-xl-9 py-md-3 pl-md-5 bd-content">
      Смартфоны
      <div class="btn-toolbar btn-group-sm" role="toolbar">
        <button
          type="button"
          class="btn btn-outline-warning"
          (click)="showGrid = false"
        >
          <mat-icon>format_list_bulleted</mat-icon>
        </button>
        <button
          type="button"
          class="btn btn-outline-warning"
          (click)="showGrid = true"
        >
          <mat-icon>apps</mat-icon>
        </button>
        <span>Cортировать по</span>
        <button
          type="button"
          class="btn btn-outline-warning"
          (click)="setSortRate()"
        >
          Популярности
        </button>
        <button
          type="button"
          class="btn btn-outline-warning"
          (click)="setSortPrice()"
        >
          <mat-icon>sort</mat-icon>Цене
        </button>
        <!-- <code>{{ sort | json }}</code> -->
      </div>

      <div *ngIf="isLoadingResults || isRateLimitReached">
        <mat-spinner *ngIf="isLoadingResults"></mat-spinner>
        <div class="example-rate-limit-reached" *ngIf="isRateLimitReached">
          Something went wrong....
        </div>
      </div>

      <div *ngIf="!showGrid" class="list-group list-group-flush">
        <a
          class="list-group-item list-group-item-action d-flex justify-content-between"
          *ngFor="
            let row of productList$
              | async
              | paginate: (paging$ | async) || pagingConfig
          "
        >
          <form>
            <div class="form-group">
              <div class="row w-100 d-block d-sm-none d-md-none">
                <div class="col">
                  <h3 class="card-title">{{ row.name }}</h3>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <img
                    src="{{ row.thumbImageUrlConverted }}"
                    class="rounded mx-auto d-block float-left"
                    alt="{{ row.name }}"
                  />
                </div>
                <div class="col d-none d-sm-block d-md-block">
                  <div class="card-body">
                    <h3 class="card-title">{{ row.name }}</h3>
                    <div class="col w-100">
                      <button type="button" class="btn link-dashed">
                        <mat-icon>assessment</mat-icon> Добавить в сравнение
                      </button>
                    </div>
                    <table class="table">
                      <tbody>
                        <tr *ngFor="let parameter of row.parameters">
                          <th scope="row">{{ parameter.name }}</th>
                          <td>{{ parameter.value }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="col">
                  <div class="card-body">
                    <h1 class="card-title">
                      {{ row.regionProduct.price | number: "1.1-1" }}
                    </h1>
                    <div class="col w-100 d-flex justify-content-between">
                      <button type="button" class="btn buttom-warning">
                        Купить
                      </button>
                      <button type="button" class="btn btn-link">
                        Быстрый заказ
                      </button>
                    </div>
                    <div class="col">
                      <button
                        class="btn btn-link"
                        *ngFor="
                          let deliveryMethod of row.regionProduct
                            .deliveryMethods
                        "
                      >
                        {{ deliveryMethod.type }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </a>
      </div>

      <div class="row" *ngIf="showGrid">
        <div
          class="row list-group-item list-group-item-action"
          *ngFor="
            let row of productList$
              | async
              | paginate: (paging$ | async) || pagingConfig
          "
          style="width: 18rem"
        >
          <form>
            <div class="form-group">
              <div class="col w-100">
                <h3 class="card-title">{{ row.name }}</h3>
              </div>
              <div class="col w-100">
                <img
                  src="{{ row.thumbImageUrlConverted }}"
                  class="rounded mx-auto d-block float-left"
                  alt="{{ row.name }}"
                />
              </div>
              <div class="col w-100">
                <div class="card-body">
                  <h1 class="card-title">
                    {{ row.regionProduct.price | number: "1.1-1" }}
                  </h1>
                  <div class="col w-100 d-flex justify-content-between">
                    <button type="button" class="btn buttom-warning">
                      Купить
                    </button>
                    <button type="button" class="btn link-dashed">
                      Быстрый заказ
                    </button>
                  </div>
                  <div class="col">
                    <button
                      class="btn btn-link"
                      *ngFor="
                        let deliveryMethod of row.regionProduct.deliveryMethods
                      "
                    >
                      {{ deliveryMethod.type }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <pagination-controls
        (pageChange)="setPage($event)"
        id="server"
      ></pagination-controls>
    </main>
  </div>
</div>
